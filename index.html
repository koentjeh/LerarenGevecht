<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

	<link rel="stylesheet" href="core.css">

	<link href='https://fonts.googleapis.com/css?family=Roboto:300,400,500' rel='stylesheet' type='text/css'>
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

	<title>LerarenGevecht</title>
	<link rel="shortcut icon" type="image/ico" href="image/favicon.ico"/>
</head>
<style>
#header,.progress{position:relative}#header,.card{box-shadow:0 2px 2px 0 rgba(0,0,0,.14),0 3px 1px -2px rgba(0,0,0,.2),0 1px 5px 0 rgba(0,0,0,.12)}*{margin:0;padding:0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}body,html{height:100%}body{font-family:Roboto,sans-serif;background-color:#f9f9f9;display:flex;flex-direction:column}canvas{width:700px;max-height:100%;max-width:100%;margin:10px auto;background-color:#fff}#header{width:100%;height:56px;color:#fff;background-color:#E30613}#header .menu-right{float:right;height:56px;box-sizing:border-box}#header .menu-right i{padding:16px;cursor:pointer}#header .menu-right i:active{background-color:rgba(255,255,255,.3)}#header .menu-right p{float:left;line-height:56px}.header-logo{padding:16px;height:24px}.progress{display:block;top:0;left:0;height:4px;width:100%;background-color:#acece6;border-radius:2px;overflow:hidden}.progress .indeterminate{background-color:#03A9F4}.progress .indeterminate:after,.progress .indeterminate:before{content:'';position:absolute;background-color:inherit;top:0;left:0;bottom:0;will-change:left,right}.progress .indeterminate:before{-webkit-animation:indeterminate 2.1s cubic-bezier(.65,.815,.735,.395) infinite;animation:indeterminate 2.1s cubic-bezier(.65,.815,.735,.395) infinite}.progress .indeterminate:after{-webkit-animation:indeterminate-short 2.1s cubic-bezier(.165,.84,.44,1) infinite;animation:indeterminate-short 2.1s cubic-bezier(.165,.84,.44,1) infinite;-webkit-animation-delay:1.15s;animation-delay:1.15s}.card{width:100%;max-width:720px;min-height:40px;margin:20px auto;padding:0 10px;background-color:#fff;border-radius:3px;overflow:auto;box-sizing:border-box}@-webkit-keyframes indeterminate{0%{left:-35%;right:100%}100%,60%{left:100%;right:-90%}}@keyframes indeterminate{0%{left:-35%;right:100%}100%,60%{left:100%;right:-90%}}@-webkit-keyframes indeterminate-short{0%{left:-200%;right:100%}100%,60%{left:107%;right:-8%}}@keyframes indeterminate-short{0%{left:-200%;right:100%}100%,60%{left:107%;right:-8%}}
</style>
<body>

<header id="header">
	<img src="image/logo.png" class="header-logo">
	<div class="menu-right">
		<!-- <p>FPS: <span id="fpscounter">0</span></p> -->
		<i class="material-icons">fullscreen</i>
	</div>
</header>
<!-- <div class="progress"><div class="indeterminate"></div></div> -->

<section id="game" class="card">
	<canvas id="canvas" width="1200" height="660" style="width:700px;height:385px;"></canvas>
</section>



<script src="options.js"></script>
<script src="powers.js"></script>
<script src="players.js"></script>
<script>
var canvas = document.getElementById("canvas");
var ctx = canvas.getContext("2d");

if(game.player[1] == null){
	game.player[1] = characters[0];
}
if(game.player[2] == null){
	game.player[2] = characters[1];
}

var arrowturnDir = 1;
var arrowturnY = 250;
var	arrowturnYMax = 260;

////////// images ///////////
var backgroundimg = new Image();
backgroundimg.src = "image/background/"+options.background.image+".jpg";

var playerturn = new Image();
playerturn.src = "image/arrow_down.gif";

for(var i = 0; i < Object.keys(characters).length; i++) {
	characters[i].id = new Image();
	characters[i].id.src = "image/character/player1/"+characters[i].character+".gif";
}
for(var i = 0; i < Object.keys(characters).length; i++) {
	characters[i].id2 = new Image();
	characters[i].id2.src = "image/character/player2/"+characters[i].character+".gif";
}

window.onload = function(){
	setup();
	// redraw();
	// game.player.turn = 1;
	// setInterval(redraw, 1000 / options.game.fps);
}

var count1 = 0;
var count2 = 0;

// canvas.addEventListener("mousewheel", function(e){
// 	if (e.wheelDeltaY < 0 && e.clientX >= 0 && e.offsetX <= 290) {
// 		count1++;
// 	} else if(e.wheelDeltaY > 0 && e.clientX >= 0 && e.offsetX <= 290) {
// 		count1--;
// 	} else if (e.wheelDeltaY < 0 && e.clientX >= 407 && e.offsetX <= 700) {
// 		count2++;
// 	} else if (e.wheelDeltaY > 0 && e.clientX >= 407 && e.offsetX <= 700) {
// 		count2--;
// 	}
// 	setup();
// }, false);

function setup(){
	ctx.clearRect(0, 0, canvas.width, canvas.height);

	ctx.fillStyle = "#f9f9f9";
	ctx.fillRect(0, 0, 500, canvas.height);
	ctx.fillRect(canvas.width - 500, 0, 500, canvas.height);

	ctx.fillStyle = "#E30613";
	ctx.moveTo(500, 0);
	ctx.lineTo(600, 0);
	ctx.lineTo(500, 50);
	ctx.moveTo(700, 660);
	ctx.lineTo(550, 660);
	ctx.lineTo(700, 600);
	ctx.fill();
	ctx.fillRect(500, 253, 200, 100);

	ctx.font = "56px Arial";
	ctx.textAlign = "center";
	ctx.fillStyle = "#fff";
	ctx.fillText("START", canvas.width / 2, canvas.height / 2);

	ctx.font = "26px Arial";
	ctx.fillStyle = "#fff";
	ctx.fillText("p1", 525, 20);
	ctx.fillText("p2", 670, 650);

	posx = 200;
	posy = 0;

	cHeight = canvas.height / 4;
	cWidth = cHeight / 1.5;

	for(i = count1; i < Object.keys(characters).length; i++) {
		selectCharacter(characters[i].id, posx, posy, cWidth, cHeight);
		posy = posy + cHeight;
	}

	posx = 900;
	posy = 0;

	cHeight = canvas.height / 4;
	cWidth = cHeight / 1.5;

	for(i = count2; i < Object.keys(characters).length; i++) {
		selectCharacter(characters[i].id2, posx, posy, cWidth, cHeight);
		posy = posy + cHeight;
	}

	var player1img = new Image();
	player1img.src = "image/character/player1/"+game.player[1].character+".gif";

	var player2img = new Image();
	player2img.src = "image/character/player2/"+game.player[2].character+".gif";

	if(game.player[1] !== null){
		selectCharacter(player1img, 570, 80, 80, 120);
	}
	if(game.player[2] !== null){
		selectCharacter(player2img, 570, 440, 80, 120);
	}

	canvas.onclick = function(e){
		if(e.offsetX >= 0 && e.offsetX <= 290 && e.offsetY >= 0 && e.offsetY < 97) {
			game.player[1] = characters[0];
		} else if (e.offsetX >= 0 && e.offsetX <= 290 && e.offsetY >= 97 && e.offsetY < 193) {
			game.player[1] = characters[1];
		} else if (e.offsetX >= 0 && e.offsetX <= 290 && e.offsetY >= 193 && e.offsetY < 290) {
			game.player[1] = characters[2];
		} else if (e.offsetX >= 0 && e.offsetX <= 290 && e.offsetY >= 290 && e.offsetY < 383) {
			game.player[1] = characters[3];
		} else if(e.offsetX >= 410 && e.offsetX <= 700 && e.offsetY >= 0 && e.offsetY < 97) {
			game.player[2] = characters[0];
		} else if (e.offsetX >= 410 && e.offsetX <= 700 && e.offsetY >= 97 && e.offsetY < 193) {
			game.player[2] = characters[1];
		} else if (e.offsetX >= 410 && e.offsetX <= 700 && e.offsetY >= 193 && e.offsetY < 290) {
			game.player[2] = characters[2];
		} else if (e.offsetX >= 410 && e.offsetX <= 700 && e.offsetY >= 290 && e.offsetY < 383) {
			game.player[2] = characters[3];
		}
		setup();

		if(e.offsetX >= 292 && e.offsetX <= 406 && e.offsetY >= 147 && e.offsetY <= 204){
			game.player.turn = 1;
			setInterval(redraw, 1000 / options.game.fps);
		}
	};
}

function selectCharacter(character, x, y, width, height){
	ctx.drawImage(character, x, y, width, height);
}

function redraw(){
	canvas.width = canvas.width;

	var player1img = new Image();
	player1img.src = "image/character/player1/"+game.player[1].character+".gif";

	var player2img = new Image();
	player2img.src = "image/character/player2/"+game.player[2].character+".gif";

	// menu
	ctx.fillStyle = "#3E2723";
	ctx.rect(0, 0, 1200, 60);
	ctx.rect(0, 510, 1200, 150);
	ctx.fill();

	// stats
	ctx.fillStyle = "#000000";
	ctx.fillRect(10, 5, 100, 31);
	ctx.fillRect(1090, 5, 100, 31);

	ctx.fillStyle="#D50000";
	ctx.fillRect(10, 5, (game.player[1].stats.health / 100) * 100, 15);
	ctx.fillRect(1090, 5, (game.player[2].stats.health / 100) * 100, 15);

	ctx.fillStyle = "#43A047";
	ctx.fillRect(10, 21, (game.player[1].stats.energy / 100) * 100, 15);
	ctx.fillRect(1090, 21, (game.player[2].stats.energy / 100) * 100, 15);


	ctx.font = "12px Arial";
	ctx.textAlign = "left";
	ctx.fillStyle = "#ffffff";
	ctx.fillText(game.player[1].name, 10, 52);
	ctx.fillText(game.player[2].name, 1090, 52);

	ctx.font = "10px Arial";
	ctx.textAlign = "center";
	ctx.fillText(game.player[1].stats.health+"/100", 60, 16);
	ctx.fillText(game.player[1].stats.energy+"/100", 60, 32);
	ctx.fillText(game.player[2].stats.health+"/100", 1140, 16);
	ctx.fillText(game.player[2].stats.energy+"/100", 1140, 32);

	ctx.font = "18px Arial";
	ctx.fillText(options.default.actiontext, 600, 535);
	ctx.fillText(options.default.actiondamage, 600, 565);
	ctx.fillText(options.default.actionhealing, 600, 585);
	ctx.fillText(options.default.actionenergy, 600, 605);

	var posy = 520;
	ctx.textAlign = "left";

	for (i = 1; i <= Object.keys(game.player[1].powers).length; i++) {
		posy = posy + 24;
		ctx.fillText(i+": "+game.player[1].powers[i].name, 10, posy);
	}

	ctx.textAlign = "right";
	var posy = 520;
	for (i = 1; i <= Object.keys(game.player[2].powers).length; i++) {
		posy = posy + 24;
		ctx.fillText(i+": "+game.player[2].powers[i].name, 1190, posy);
	}

	ctx.drawImage(backgroundimg, 0, 60, 1200, 450);
	ctx.drawImage(player1img, 100, 300, 110, 195);
	ctx.drawImage(player2img, 1000, 300, 110, 195);

	thisplayerturn();
}

function thisplayerturn(){
	if (arrowturnDir === 1) {
		arrowturnY += 1;

		if (arrowturnY > 260) {
			arrowturnDir = -1;
		}
	} else {
		arrowturnY -= 1;

		if(arrowturnY < 240) {
			arrowturnDir = 1;
		}
	}

	if(game.player.turn === 1) {
		posX = 135;
		ctx.drawImage(playerturn, posX, arrowturnY, 40, 40);
	} else if (game.player.turn === 2) {
		posX = 1035;
		ctx.drawImage(playerturn, posX, arrowturnY, 40, 40);
	}
}

document.body.onkeypress = function(e) {
	if(e.keyCode === 49 || e.keyCode === 50 || e.keyCode === 51 || e.keyCode === 52 || e.keyCode === 53) {
		switch(e.keyCode){
			case 49:
				move = 1;
				break;
			case 50:
				move = 2;
				break;
			case 51:
				move = 3;
				break;
			case 52:
				move = 4;
				break;
			case 53:
				move = 5;
				break;
		}

		if (game.player.turn === 1) {
			if(game.player[1].stats.energy - game.player[1].powers[move].energy.cost < 0){
				alert('Niet genoeg energie');
			} else {
				damage = randomNumber(game.player[1].powers[move].damage.min, game.player[1].powers[move].damage.max);
				healing = randomNumber(game.player[1].powers[move].healing.min, game.player[1].powers[move].healing.max)

				options.default.actiontext = game.player[1].name+" gebruikt: "+game.player[1].powers[move].name;
				options.default.actiondamage = "Schade: -"+damage;
				options.default.actionhealing = "Levens: +"+healing;

				if (game.player[1].powers[move].energy.cost === 0) {
					options.default.actionenergy = "Energie: +"+game.player[1].powers[move].energy.generate;
					game.player[1].stats.energy += game.player[1].powers[move].energy.generate;
					if (game.player[1].stats.energy > 100) {
						game.player[1].stats.energy = 100;
					}
				} else {
					options.default.actionenergy = "Energie: -"+game.player[1].powers[move].energy.cost;
					game.player[1].stats.energy -= game.player[1].powers[move].energy.cost;
					if (game.player[1].stats.energy < 0) {
						game.player[1].stats.energy = 0;
					}
				}

				game.player[1].stats.health += healing;
				if (game.player[1].stats.health > 100) {
					game.player[1].stats.health = 100;
				}

				game.player[2].stats.health -= damage;
				if (game.player[2].stats.health < 0) {
					game.player[2].stats.health = 0;
					alert(game.player[2].name+" is dood");
					window.location.reload();
				}
				game.player.turn = 2;
			}
		} else if (game.player.turn === 2) {
			if(game.player[2].stats.energy - game.player[2].powers[move].energy.cost < 0){
				alert('Niet genoeg energie');
			} else {
				if(game.player[2].powers[move].energy.cost === 0){
					options.default.actionenergy = "Energie: +"+game.player[2].powers[move].energy.generate;
					game.player[2].stats.energy += game.player[2].powers[move].energy.generate;
					if (game.player[2].stats.energy > 100) {
						game.player[2].stats.energy = 100;
					}
				} else {
					options.default.actionenergy = "Energie: -"+game.player[2].powers[move].energy.cost;
					game.player[2].stats.energy -= game.player[2].powers[move].energy.cost;
					if (game.player[2].stats.energy < 0) {
						game.player[2].stats.energy = 0;
					}
				}

				damage = randomNumber(game.player[2].powers[move].damage.min, game.player[2].powers[move].damage.max);
				healing = randomNumber(game.player[2].powers[move].healing.min, game.player[2].powers[move].healing.max);

				options.default.actiontext = game.player[2].name+" gebruikt: "+game.player[2].powers[move].name;
				options.default.actiondamage = "Schade: -"+damage;
				options.default.actionhealing = "Levens: +"+healing;

				game.player[2].stats.health += healing;
				if (game.player[2].stats.health > 100) {
					game.player[2].stats.health = 100;
				}

				game.player[1].stats.health -= damage;
				if (game.player[1].stats.health <= 0) {
					game.player[1].stats.health = 0;
					alert(game.player[1].name+" is dood");
					window.location.reload();
				}
				game.player.turn = 1;
			}
		} else {
			alert("Niemand is aan de beurt");
		}
	}
}

function randomNumber(min, max){
	return Math.floor(Math.random()*(max-min+1)+min);
}
function averageNumber(min, max){
	return (min + max) / 2;
}
</script>
</body>
</html>